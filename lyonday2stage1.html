<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>WSC2024 TP53 - Day2 - Stage 0 & Stage 1 (Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ù†Ø³ÙˆÙ„)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --text:#e5e7eb; --accent:#22d3ee; --border:#1f2937; }
    html,body{margin:0;padding:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:1100px;margin:32px auto;padding:16px}
    h1{font-size:28px;margin:0 0 16px}
    h2{font-size:22px;margin:24px 0 12px}
    h3{font-size:18px;margin:16px 0 10px}
    p,li{line-height:1.8}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;margin:14px 0}
    .muted{color:var(--muted);font-size:13px}
    .badge{display:inline-block;background:#0ea5e9; color:#00131a;padding:2px 8px;border-radius:999px;font-weight:700;font-size:12px}
    .toc a{color:var(--accent);text-decoration:none}
    .toc ul{margin:8px 0 0 0;padding:0 18px}
    details{background:#0b1220;border:1px solid var(--border);border-radius:12px;padding:10px 12px;margin:10px 0}
    details summary{cursor:pointer;font-weight:700}
    code, pre{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:13px}
    pre{background:#0b1320;border:1px solid var(--border);border-radius:12px;padding:12px;overflow:auto;position:relative;margin:10px 0}
    .copy-btn{position:absolute;top:8px;left:8px;padding:6px 10px;border:1px solid var(--border);background:#0e1725;color:var(--text);border-radius:8px;cursor:pointer;font-size:12px}
    .list-check li{margin-bottom:6px}
    .kbd{border:1px solid var(--border);border-bottom-width:2px;padding:0 6px;border-radius:6px;background:#0e1725}
    .two-col{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:860px){.two-col{grid-template-columns:1fr 1fr}}
    .note{border-right:4px solid #22d3ee;padding-right:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>WSC2024 TP53 â€” Day 2 â€” Stage 0 & Stage 1 (Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ù…Ù„ Ú©Ù†Ø³ÙˆÙ„)</h1>
    <p class="muted">Region: <b>us-east-1</b> | Ù…Ù…Ù†ÙˆØ¹: EKS | ØªÙˆØµÛŒÙ‡â€ŒØ´Ø¯Ù‡: ECS/CodePipeline (Ø¨Ø±Ø§ÛŒ Stage 2) | Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø³ØªØ±Ø³ÛŒ Ø±ÙˆÛŒ SSM</p>

    <div class="card toc">
      <h3>ÙÙ‡Ø±Ø³Øª</h3>
      <ul>
        <li><a href="#stage0">Ù…Ø±Ø­Ù„Ù‡ Û° â€” Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒÙ‡ (Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§)</a></li>
        <li><a href="#stage1">Stage 1 â€” Data Reception</a></li>
        <li><a href="#bp-sql">Ú©Ø¯Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… (SQL & KDA)</a></li>
        <li><a href="#tips">Ù†Ú©Ø§Øª Ø§Ù…ØªÛŒØ§Ø²ÛŒ Ùˆ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ</a></li>
      </ul>
    </div>

    <div id="stage0" class="card">
      <h2>Ù…Ø±Ø­Ù„Ù‡ Û° â€” Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø§ÛŒÙ‡ (Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²Ù‡Ø§) <span class="badge">Required</span></h2>

      <details open>
        <summary>Û±) Ø¨ÙˆØ¯Ø¬Ù‡ Ùˆ ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ</summary>
        <ol class="list-check">
          <li>Ø¨Ø±Ùˆ <b>AWS Budgets</b> â†’ <b>Create budget</b> â†’ Ù†ÙˆØ¹ <b>Cost budget</b> â†’ Ù…Ù‚Ø¯Ø§Ø± Ù…Ø«Ù„Ø§Ù‹ <b>10$</b> â†’ Ù‡Ø´Ø¯Ø§Ø± Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯Øª.</li>
          <li>ÛŒÚ© ØªÚ¯ Ù…Ø´ØªØ±Ú© Ø¨Ø±Ø§ÛŒ Ù‡Ù…Ù‡ Ù…Ù†Ø§Ø¨Ø¹: <code>Project=TP53-Day2</code> (Ø¯Ø± Ù‡Ù†Ú¯Ø§Ù… Ø³Ø§Ø®Øª Ù‡Ø± Ø³Ø±ÙˆÛŒØ³ Ø³Øª Ú©Ù†).</li>
        </ol>
      </details>

      <details>
        <summary>Û²) S3 Bucket Ø¨Ø±Ø§ÛŒ Ø¢Ø±ØªÛŒÙÚ©Øªâ€ŒÙ‡Ø§ / Ù„Ø§Ú¯â€ŒÙ‡Ø§</summary>
        <ol class="list-check">
          <li>S3 â†’ <b>Create bucket</b> â†’ Ù†Ø§Ù… Ù…Ø«Ù„: <code>tp53-day2-artifacts-yourname</code> (Region: us-east-1)</li>
          <li><b>Block all public access = ON</b>ØŒ <b>Versioning = Enable</b>.</li>
        </ol>
      </details>

      <details>
        <summary>Û³) IAM Role Ø¨Ø±Ø§ÛŒ Kinesis Data Analytics</summary>
        <ol class="list-check">
          <li>IAM â†’ Roles â†’ <b>Create role</b> â†’ Use case: <b>Kinesis Analytics</b>.</li>
          <li>Policies (Ø­Ø¯Ø§Ù‚Ù„): <code>AmazonKinesisFullAccess</code>ØŒ <code>AmazonDynamoDBFullAccess</code>ØŒ <code>CloudWatchLogsFullAccess</code>.</li>
          <li>Ù†Ø§Ù…: <code>kda-bp-role</code> â†’ Create.</li>
        </ol>
      </details>

      <details>
        <summary>Û´) Ø¨Ø±Ø±Ø³ÛŒ/Ø§ÛŒØ¬Ø§Ø¯ Default VPC</summary>
        <ol>
          <li>VPC â†’ Your VPCs â†’ Ø§Ú¯Ø± Default Ù†ÛŒØ³Øª: Ø§Ø² <b>Actions â†’ Create default VPC</b> Ø¨Ø³Ø§Ø².</li>
        </ol>
      </details>

      <details>
        <summary>Ûµ) Security Groupâ€Œ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØªØ§Ø¨ÛŒØ³â€ŒÙ‡Ø§</summary>
        <div class="two-col">
          <div class="note">
            <h4>Aurora</h4>
            <ul>
              <li>Ù†Ø§Ù…: <code>sg-aurora-public</code></li>
              <li>Inbound: MySQL/Aurora (3306) â†’ <b>My IP</b></li>
            </ul>
          </div>
          <div class="note">
            <h4>Redshift</h4>
            <ul>
              <li>Ù†Ø§Ù…: <code>sg-redshift-public</code></li>
              <li>Inbound: Redshift (5439) â†’ <b>My IP</b></li>
            </ul>
          </div>
        </div>
      </details>

      <details>
        <summary>Û¶) DynamoDB Table (Ù†ØªØ§ÛŒØ¬ Ø¢Ù†ÛŒ ÙØ´Ø§Ø± Ø®ÙˆÙ†)</summary>
        <ol>
          <li>DynamoDB â†’ Tables â†’ <b>Create table</b></li>
          <li>Table name: <code>cloudraiser-iot</code> | Partition key: <code>No</code> (String)</li>
          <li>Ø¨Ø¹Ø¯ Ø§Ø² Ø³Ø§Ø®Øª: ØªØ¨ <b>Additional settings â†’ TTL</b> â†’ Enable â†’ Attribute name: <code>expireAt</code></li>
        </ol>
      </details>

      <details>
        <summary>Û·) CloudWatch Logs (Ø¨Ø±Ø§ÛŒ KDA)</summary>
        <ol>
          <li>CloudWatch â†’ Logs â†’ Log groups â†’ <b>Create log group</b> â†’ Ù†Ø§Ù…: <code>/kinesis/blood-pressure-analytics</code></li>
        </ol>
      </details>
    </div>

    <div id="stage1" class="card">
      <h2>Stage 1 â€” Data Reception</h2>

      <details open>
        <summary>Ø§Ù„Ù) Blood Pressure Data â€” Kinesis Stream</summary>
        <ol>
          <li>Kinesis â†’ Data streams â†’ <b>Create data stream</b></li>
          <li>Name: <code>blood-pressure-stream</code> | Shards: <code>1</code> â†’ Create â†’ ÙˆØ¶Ø¹ÛŒØª: <b>ACTIVE</b>.</li>
        </ol>
      </details>

      <details open>
        <summary>Ø¨) Kinesis Data Analytics (SQL + Random Cut Forest)</summary>
        <ol>
          <li>Kinesis Data Analytics â†’ <b>Create application</b> â†’ Name: <code>blood-pressure-analytics</code> â†’ Runtime: <b>SQL</b> â†’ Create.</li>
          <li>Source: Ù†ÙˆØ¹ <b>Kinesis data stream</b> â†’ Stream: <code>blood-pressure-stream</code></li>
          <li>Schema (Ù…Ø«Ø§Ù„ Ø³Ø§Ø¯Ù‡): <code>no STRING, systolic DOUBLE, diastolic DOUBLE</code></li>
          <li>SQL editor: Ø§Ø³Ú©Ø±ÛŒÙ¾Øª RCF Ø±Ø§ Ø§Ø² Ø¨Ø®Ø´ <a href="#bp-sql">Â«Ú©Ø¯Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù…Â»</a> ÙˆØ§Ø±Ø¯ Ú©Ù†.</li>
          <li>Destination: <b>DynamoDB</b> â†’ Table: <code>cloudraiser-iot</code> â†’ Role: <code>kda-bp-role</code></li>
          <li><b>Run application</b> (Ù„Ø§Ú¯â€ŒÙ‡Ø§ Ø¯Ø±: <code>/kinesis/blood-pressure-analytics</code>).</li>
        </ol>
      </details>

      <details open>
        <summary>Ø¬) Redshift (ØªØ­Ù„ÛŒÙ„ ØªØ§Ø±ÛŒØ®ÛŒ)</summary>
        <ol>
          <li>Redshift â†’ Clusters â†’ <b>Create cluster</b></li>
          <li>Identifier: <code>blood-pressure-redshift</code> | Node type: <code>dc2.large</code> | Nodes: <code>1</code></li>
          <li>DB name: <code>analytics</code> | Publicly accessible: <b>Yes</b> | SG: <code>sg-redshift-public</code></li>
          <li>Ø§ÛŒØ¬Ø§Ø¯ Cluster â†’ Ù…Ù†ØªØ¸Ø± Ø¨Ù…Ø§Ù† ØªØ§ <b>Available</b> Ø´ÙˆØ¯.</li>
        </ol>
        <p class="muted">ÛŒØ§Ø¯Ø¢ÙˆØ±ÛŒ: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Serverless Ø¨Ø±Ø§ÛŒ Redshift Ø¯Ø± Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ù…Ù…Ù†ÙˆØ¹ Ø§Ø³Øª.</p>
      </details>

      <details open>
        <summary>Ø¯) Aurora (Enterprise Operation Data)</summary>
        <ol>
          <li>RDS â†’ <b>Create database</b> â†’ Engine: <b>Amazon Aurora</b> (MySQL-compatible) â†’ Template: <b>Free tier</b>.</li>
          <li>DB cluster id: <code>enterprise-cluster</code> | Master: <code>admin</code> | Password: Ø§Ù…Ù†</li>
          <li>Public access: <b>Yes</b> | SG: <code>sg-aurora-public</code> | Create.</li>
          <li>Ù¾Ø³ Ø§Ø² Available Ø´Ø¯Ù†ØŒ Query editor Ø±Ø§ Ø¨Ø§Ø² Ú©Ù† Ùˆ Ø¬Ø¯ÙˆÙ„ Ø±Ø§ Ø¨Ø³Ø§Ø² (Ù¾Ø§ÛŒÛŒÙ† ğŸ‘‡).</li>
        </ol>
        <pre><button class="copy-btn" onclick="copyBlock(this)">Copy</button><code>
CREATE TABLE enterprise_data (
  id VARCHAR(20) PRIMARY KEY,
  val1 VARCHAR(100),
  val2 VARCHAR(100),
  val3 VARCHAR(100),
  val4 VARCHAR(100),
  val5 VARCHAR(100),
  val6 VARCHAR(100),
  val7 VARCHAR(100),
  val8 VARCHAR(100),
  val9 VARCHAR(100),
  val10 VARCHAR(100)
);
        </code></pre>
      </details>
    </div>

    <div id="bp-sql" class="card">
      <h2>Ú©Ø¯Ù‡Ø§ÛŒ Ù„Ø§Ø²Ù… (SQL & KDA)</h2>

      <details open>
        <summary>Û±) ØªØ¹Ø±ÛŒÙ Ø§Ø³ØªØ±ÛŒÙ… Ù…Ù‚ØµØ¯ Ùˆ Ù¾Ù…Ù¾ RCF Ø¯Ø± KDA (Ù†Ù…ÙˆÙ†Ù‡ Ø³Ø§Ø¯Ù‡)</summary>
        <pre><button class="copy-btn" onclick="copyBlock(this)">Copy</button><code>
-- Ø®Ø±ÙˆØ¬ÛŒ Ø¢Ù†Ø§Ù„ÛŒØ² Ø¨Ù‡ ÛŒÚ© Ø§Ø³ØªØ±ÛŒÙ… Ù…Ù‚ØµØ¯
CREATE OR REPLACE STREAM "DESTINATION_SQL_STREAM" (
  no VARCHAR(32),
  systolic DOUBLE,
  diastolic DOUBLE,
  anomalyScore DOUBLE,
  expireAt BIGINT
);

-- Ù¾Ù…Ù¾: Ø§Ø¬Ø±Ø§ÛŒ RCF Ø±ÙˆÛŒ ÙˆØ±ÙˆØ¯ÛŒ
CREATE OR REPLACE PUMP "STREAM_PUMP" AS INSERT INTO "DESTINATION_SQL_STREAM"
SELECT STREAM
  no,
  systolic,
  diastolic,
  ANOMALY_SCORE AS anomalyScore,
  -- TTL Ø¨Ø±Ø§ÛŒ Ø­Ø°Ù Ø®ÙˆØ¯Ú©Ø§Ø± Ù¾Ø³ Ø§Ø² 48 Ø³Ø§Ø¹Øª (172800 Ø«Ø§Ù†ÛŒÙ‡)
  CAST((FLOOR(EXTRACT(EPOCH FROM CURRENT_TIMESTAMP) + 172800)) AS BIGINT) AS expireAt
FROM TABLE(
  RANDOM_CUT_FOREST(
    CURSOR(SELECT STREAM systolic, diastolic FROM "SOURCE_SQL_STREAM_001"),
    100, 256
  )
);
        </code></pre>
        <p class="muted">Ù†Ú©ØªÙ‡: Ø¯Ø± Destination mapping Ø¨Ø±Ø§ÛŒ DynamoDBØŒ ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ø¨Ù‡ Ø³ØªÙˆÙ†â€ŒÙ‡Ø§ÛŒ Ø¬Ø¯ÙˆÙ„ <code>cloudraiser-iot</code> Ù…Ù¾ Ú©Ù† (No/Systolic/Diastolic/Score). Ø§Ú¯Ø± Ù†Ø§Ù…â€ŒÙ‡Ø§ Ù…ØªÙØ§ÙˆØª Ø§Ø³ØªØŒ Ø§Ø² ÛŒÚ© SQL Ù…ÛŒØ§Ù†ÛŒ Ø¨Ø±Ø§ÛŒ Rename Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†.</p>
      </details>

      <details>
        <summary>Û²) Ø³Ø§Ø®ØªØ§Ø± Ø¬Ø¯ÙˆÙ„ DynamoDB Ù…ÙˆØ±Ø¯Ù†ÛŒØ§Ø² Ù…Ø³Ø§Ø¨Ù‚Ù‡</summary>
        <pre><button class="copy-btn" onclick="copyBlock(this)">Copy</button><code>
Table: cloudraiser-iot
Partition key: No (String)
Attributes:
- No (String)          -- Ú©Ù„ÛŒØ¯ Ù¾Ø§Ø±ØªÛŒØ´Ù†
- Systolic (String)
- Diastolic (String)
- Score (String)       -- ÛŒØ§ anomalyScore Ø¨Ù‡ Ø¹Ù†ÙˆØ§Ù† Score
- expireAt (Number)    -- Ø¨Ø±Ø§ÛŒ TTL (Epoch seconds)
        </code></pre>
      </details>
    </div>

    <div id="tips" class="card">
      <h2>Ù†Ú©Ø§Øª Ø§Ù…ØªÛŒØ§Ø²ÛŒØŒ Ù¾Ø§ÛŒØ´ Ùˆ Ù‡Ø²ÛŒÙ†Ù‡</h2>
      <ul>
        <li><b>CloudWatch Alarms:</b> Ø¨Ø±Ø§ÛŒ Kinesis (IteratorAgeHigh)ØŒ DynamoDB (ThrottledRequests)ØŒ Redshift (CPU/Queue).</li>
        <li><b>TTL</b> Ø±ÙˆÛŒ DynamoDB Ø­ØªÙ…Ø§Ù‹ Ø±ÙˆØ´Ù† Ø¨Ø§Ø´Ø¯ (Ø­Ø°Ù Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ &gt; Û´Û¸ Ø³Ø§Ø¹Øª).</li>
        <li><b>ØªÚ¯â€ŒÚ¯Ø°Ø§Ø±ÛŒ</b>: Ø±ÙˆÛŒ Ù‡Ù…Ù‡ Ù…Ù†Ø§Ø¨Ø¹ <code>Project=TP53-Day2</code> Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ù‡Ø²ÛŒÙ†Ù‡.</li>
        <li><b>Ø§Ù…Ù†ÛŒØª ØªØ³ØªÛŒ</b>: SGÙ‡Ø§ Ø±Ø§ ÙÙ‚Ø· Ø§Ø² <b>My IP</b> Ø¨Ø§Ø² Ú©Ù†Ø› Ø¨Ø¹Ø¯Ø§Ù‹ Ù…ÛŒâ€ŒØ´ÙˆØ¯ Ø®ØµÙˆØµÛŒâ€ŒØ³Ø§Ø²ÛŒ Ú©Ø±Ø¯ (VPC Endpoints/KMS).</li>
        <li><b>Serverless Redshift Ù…Ù…Ù†ÙˆØ¹</b> (Ø·Ø¨Ù‚ Ù…Ø³ØªÙ†Ø¯ Ù…Ø³Ø§Ø¨Ù‚Ù‡).</li>
        <li>Stage 2 Ø±Ø§ Ø¨Ø§ <b>ECS + CodePipeline</b> Ù¾ÛŒØ´ Ø¨Ø¨Ø± (Ø¨Ø§ÛŒÙ†Ø±ÛŒ Ù…Ø³Ø§Ø¨Ù‚Ù‡ Ø±ÙˆÛŒ ECS Fargate).</li>
      </ul>
    </div>

    <p class="muted">Ø§Ø¯Ø§Ù…Ù‡: Ø§Ú¯Ø± Ø®ÙˆØ§Ø³ØªÛŒØŒ Ù†Ø³Ø®Ù‡â€ŒÛŒ HTML Ø¨Ø±Ø§ÛŒ Stage 2 (ECS + APIÙ‡Ø§ + Ù„Ø§Ú¯/Ù…Ø§Ù†ÛŒØªÙˆØ±ÛŒÙ†Ú¯) Ù‡Ù… Ø¨Ø±Ø§Øª Ø¢Ù…Ø§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†Ù….</p>
  </div>

  <script>
    function copyBlock(btn){
      const pre = btn.parentElement;
      const code = pre.querySelector('code');
      const text = code.innerText;
      navigator.clipboard.writeText(text).then(()=>{
        const old = btn.innerText;
        btn.innerText = "Copied!";
        setTimeout(()=>btn.innerText=old,1200);
      });
    }
  </script>
</body>
</html>
