<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Code Cheat Sheet</title>
  <link rel="stylesheet" href="style.css">

</head>
<body dir="rtl">



  <h1>ğŸ“’ My Cheat Sheet</h1>

<div class="menu-part">
    <!-- trains part -->

<details>
  <summary>ØªÙ…Ø±ÛŒÙ†Ø§Øª Ø§Ø±Ø¯ÙˆÛŒ Ù…Ù„ÛŒ Ù…Ù‡Ø§Ø±Øª Û· ØªÙ…Ø±ÛŒÙ†</summary>
 <div class="details">
 <a href="trainone.html">ØªÙ…Ø±ÛŒÙ† Ø§ÙˆÙ„ (nginx base auth)</a>
 <a href="trainthree.html">ØªÙ…Ø±ÛŒÙ† Ø³ÙˆÙ… (create and push 1000 file in s3)</a>
 </div>
</details> 

<!-- terraform part -->

<details>
  <summary>ØªÙ…Ø±ÛŒÙ†Ø§Øª Ø¨Ø®Ø´ Ú©Ø§Ø±Ø¨Ø§ terraform</summary>
 <div class="details">
  <a href="terraformec2.html">create ec2 via terraform</a>
 </div>
</details> 

<!-- sql dbs part -->

<details>
  <summary>Ú©ÙˆØ¦Ø±ÛŒâ€ŒÙ‡Ø§ÛŒ Ù¾Ø§ÛŒÙ‡ Ùˆ Ø­ÛŒØ§ØªÛŒ: DATABASES</summary>
 <div class="details">
  <a href="relationshipdbs.html">MySQL / MariaDB</a>
  <a href="redis.html">Redis</a>
 </div>
</details> 

<!-- important path -->

<details>
  <summary>Ù„ÛŒØ³Øª Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ù…Ù‡Ù… Ø³ÛŒØ³ØªÙ…â€ŒÙ‡Ø§ Ùˆ Ø³Ø±ÙˆÛŒØ³â€ŒÙ‡Ø§</summary>
 <div class="details">
  <a href="path.html">path</a>
 </div>
</details> 

<!-- vpc part -->

<details>
  <summary>Ø¨Ø®Ø´ Ú©Ø§Ø± Ø¨Ø§ vpc</summary>
 <div class="details">
  <a href="vpcpeering.html">vpc peering</a>
  <a href="vpcendpointslists.html">ğŸŸ¢ Ù„ÛŒØ³Øª VPC EndpointÙ‡Ø§ÛŒ Ø®ÛŒÙ„ÛŒ Ù…Ù‡Ù…</a>
 </div>
</details> 

<!-- IRI worldskill projects -->

<details>
  <summary> IRI worldskill projects </summary>
 <div class="details">
  <a href="iran22skillday2.html">IRI 21 Day2</a>
 </div>
</details> 

</div>






   <!-- Ø¨Ø®Ø´ Linux Commands -->
  <h2 style="text-align:center;">ğŸ§ Linux Commands</h2>

  <div class="note">Ù†Ù…Ø§ÛŒØ´ Ù…Ø³ÛŒØ± ÙØ¹Ù„ÛŒ</div>
  <div class="code-box"><code>pwd</code></div>

  <hr class="separator">

  <div class="note">Ù„ÛŒØ³Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ùˆ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§</div>
  <div class="code-box"><code>ls -l</code></div>

  <hr class="separator">

  <div class="note">ØªØºÛŒÛŒØ± Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ</div>
  <div class="code-box"><code>cd /path/to/dir</code></div>

  <hr class="separator">

  <div class="note">Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ Ø¬Ø¯ÛŒØ¯</div>
  <div class="code-box"><code>mkdir new_folder</code></div>

  <hr class="separator">

  <div class="note">Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø®Ø§Ù„ÛŒ</div>
  <div class="code-box"><code>touch file.txt</code></div>

  <hr class="separator">

  <div class="note">Ù†Ù…Ø§ÛŒØ´ Ù…Ø­ØªÙˆÛŒØ§Øª ÙØ§ÛŒÙ„</div>
  <div class="code-box"><code>cat file.txt</code></div>

  <hr class="separator">

  <div class="note">ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ§ÛŒÙ„ Ø¨Ø§ nano</div>
  <div class="code-box"><code>nano file.txt</code></div>

  <hr class="separator">

  <div class="note">Ú©Ù¾ÛŒ ÙØ§ÛŒÙ„</div>
  <div class="code-box"><code>cp source.txt dest.txt</code></div>

  <hr class="separator">

  <div class="note">Ø¬Ø§Ø¨Ø¬Ø§ÛŒÛŒ ÛŒØ§ ØªØºÛŒÛŒØ± Ù†Ø§Ù… ÙØ§ÛŒÙ„</div>
  <div class="code-box"><code>mv old.txt new.txt</code></div>

  <hr class="separator">

  <div class="note">Ø­Ø°Ù ÙØ§ÛŒÙ„ ÛŒØ§ Ù¾ÙˆØ´Ù‡</div>
  <div class="code-box"><code>rm file.txt</code><br><code>rm -r folder/</code></div>

  <hr class="separator">

  <div class="note">Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø§Ø®Ù„ ÙØ§ÛŒÙ„</div>
  <div class="code-box"><code>grep "word" file.txt</code></div>

  <hr class="separator">

  <div class="note">Ù…Ø´Ø§Ù‡Ø¯Ù‡ ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±ÙˆØ³Ù‡â€ŒÙ‡Ø§</div>
  <div class="code-box"><code>ps aux</code></div>

  <hr class="separator">

  <div class="note">ÛŒØ§ÙØªÙ† Ù¾Ø±ÙˆØ³Ù‡ Ø¨Ø§ Ù†Ø§Ù…</div>
  <div class="code-box"><code>ps aux | grep nginx</code></div>

  <hr class="separator">

  <div class="note">Ø¨Ø³ØªÙ† Ù¾Ø±ÙˆØ³Ù‡</div>
  <div class="code-box"><code>kill -9 PID</code></div>

  <hr class="separator">

  <div class="note">Ù†Ù…Ø§ÛŒØ´ ÙØ¶Ø§ÛŒ Ø¯ÛŒØ³Ú©</div>
  <div class="code-box"><code>df -h</code></div>

  <hr class="separator">

  <div class="note">Ù†Ù…Ø§ÛŒØ´ ÙØ¶Ø§ÛŒ Ù¾ÙˆØ´Ù‡â€ŒÙ‡Ø§</div>
  <div class="code-box"><code>du -sh *</code></div>

  <hr class="separator">

  <div class="note">Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ Ø¨Ø§ wget</div>
  <div class="code-box"><code>wget http://example.com/file.zip</code></div>

  <hr class="separator">

  <div class="note">Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¨Ø§ curl</div>
  <div class="code-box"><code>curl -O http://example.com/file.zip</code></div>

  <hr class="separator">

  <div class="note">Ø§Ú©Ø³ØªØ±Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ zip</div>
  <div class="code-box"><code>unzip file.zip</code></div>

  <hr class="separator">

  <div class="note">Ø§Ú©Ø³ØªØ±Øª Ú©Ø±Ø¯Ù† ÙØ§ÛŒÙ„ tar.gz</div>
  <div class="code-box"><code>tar -xvzf file.tar.gz</code></div>

  <hr class="separator">

  
<hr class="separator">
<div class="note">ØªØ§ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ú©Ø§Ø±Ø¨Ø± Ø¯Ø± Amazon Cognito</div>
  <div class="code-box"><code>
    def lambda_handler(event, context):
    # Ø§Ú¯Ø± Ù…ÛŒâ€ŒØ®ÙˆØ§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ù‡Ø§ÛŒ Ø«Ø¨Øªâ€ŒØ´Ø¯Ù‡ Ø®ÙˆØ¯ØªÙˆ Ø§ØªÙˆÙ…Ø§Øª ØªØ§ÛŒÛŒØ¯ Ú©Ù†ÛŒ
    event['response']['autoConfirmUser'] = True
    event['response']['autoVerifyEmail'] = True
    event['response']['autoVerifyPhone'] = True

    return event
  </code></div>

  <div class="note">ØªØ§Ø¨Ø¹ Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ Ø´Ø¯Ù‡ (Scheduled Lambda) Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø¯Ø± S3</div>
  <div class="code-box"><code>
   const AWS = require('aws-sdk');
const s3 = new AWS.S3();
const DAY = 24 * 60 * 60 * 1000;

exports.handler = async (event) => {
    const bucket = "your-bucket-name";
    const prefix = "uploads/";

    const listResp = await s3.listObjectsV2({
        Bucket: bucket,
        Prefix: prefix
    }).promise();

    const objects = listResp.Contents;

    const now = new Date().getTime();

    const oldObjects = objects.filter(obj => {
        const lastModified = new Date(obj.LastModified).getTime();
        return (now - lastModified) > (7 * DAY); // Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² 7 Ø±ÙˆØ²
    });

    if (oldObjects.length === 0) {
        return { statusCode: 200, body: "No old files" };
    }

    // Ø­Ø°Ù ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ
    const delParams = {
        Bucket: bucket,
        Delete: {
            Objects: oldObjects.map(obj => ({ Key: obj.Key }))
        }
    };
    await s3.deleteObjects(delParams).promise();

    return { statusCode: 200, body: `Deleted ${oldObjects.length} files` };
};
  </code></div>

    <div class="note">1) Hello World (Node.js) â€” ØªØ³Øª Ø³Ø±ÛŒØ¹ ÙØ§Ù†Ú©Ø´Ù† Ùˆ Ø³Ø§Ø®ØªØ§Ø± Ù¾Ø§Ø³Ø® API Gateway</div>
  <div class="code-box"><code>
// index.js
exports.handler = async (event) => {
  return {
    statusCode: 200,
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ ok: true, message: "Hello from Lambda!" })
  };
};
  </code></div>

  <div class="note">2) Ù„Ø§Ú¯â€ŒØ¨Ø±Ø¯Ø§Ø±ÛŒ Ùˆ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± CloudWatch (Python)</div>
  <div class="code-box"><code>
import json, os, logging
logger = logging.getLogger()
logger.setLevel(logging.INFO)

def lambda_handler(event, context):
    logger.info({"event": event, "function": context.function_name})
    return {"statusCode":200, "body": json.dumps({"env": dict(os.environ)})}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ API Gateway â†” Lambda</h2>

  <div class="note">3) REST Endpoint Ø³Ø§Ø¯Ù‡ (Node.js) â€” Ù…Ø³ÛŒØ± health Ùˆ echo</div>
  <div class="code-box"><code>
// index.js
exports.handler = async (event) => {
  const path = event.rawPath || event.path || "/";
  if (path === "/health") {
    return { statusCode: 200, body: "OK" };
  }
  return { statusCode: 200, headers:{"Content-Type":"application/json"},
           body: JSON.stringify({ received: event }) };
};
  </code></div>

  <div class="note">4) Ø§Ø¹ØªØ¨Ø§Ø±Ø³Ù†Ø¬ÛŒ ÙˆØ±ÙˆØ¯ÛŒ API Ùˆ Ù¾Ø§Ø³Ø® Ø®Ø·Ø§ (Python)</div>
  <div class="code-box"><code>
import json
def lambda_handler(event, context):
    try:
        body = json.loads(event.get("body") or "{}")
        if "name" not in body:
            return {"statusCode":400, "body":"Missing 'name'"}
        return {"statusCode":200, "body": json.dumps({"hello": body["name"]})}
    except Exception as e:
        return {"statusCode":500, "body": str(e)}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ S3 Trigger Ø³Ù†Ø§Ø±ÛŒÙˆÙ‡Ø§</h2>

  <div class="note">5) Thumbnail Ø³Ø§Ø² ØªØµÙˆÛŒØ± Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ S3 (Python, Pillow Ù„Ø§Ø²Ù… Ø¯Ø§Ø±Ø¯)</div>
  <div class="code-box"><code>
# requirements: pillow
import boto3, os
from PIL import Image
s3 = boto3.client("s3")
OUT_PREFIX = "thumbs/"
SIZE = (300, 300)

def lambda_handler(event, context):
    record = event["Records"][0]
    b = record["s3"]["bucket"]["name"]
    k = record["s3"]["object"]["key"]

    tmp_in = "/tmp/in"
    tmp_out = "/tmp/out.jpg"
    s3.download_file(b, k, tmp_in)

    img = Image.open(tmp_in)
    img.thumbnail(SIZE)
    img.save(tmp_out, "JPEG")

    out_key = OUT_PREFIX + os.path.basename(k) + ".jpg"
    s3.upload_file(tmp_out, b, out_key, ExtraArgs={"ContentType":"image/jpeg"})
    return {"thumb": out_key}
  </code></div>

  <div class="note">6) JSON Validator Ø±ÙˆÛŒ S3 Object (Node.js) â€” Ø±ÛŒØ¬Ú©Øª/Ø«Ø¨Øª Ù…Ø´Ú©Ù„</div>
  <div class="code-box"><code>
// index.js
const AWS = require("aws-sdk");
const s3 = new AWS.S3();

exports.handler = async (event) => {
  const { name: Bucket } = event.Records[0].s3.bucket;
  const Key = decodeURIComponent(event.Records[0].s3.object.key);
  const data = await s3.getObject({ Bucket, Key }).promise();
  try {
    JSON.parse(data.Body.toString("utf-8"));
    console.log("Valid JSON:", Key);
  } catch (e) {
    console.error("Invalid JSON:", Key, e);
  }
  return { ok: true };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ DynamoDB CRUD</h2>

  <div class="note">7) PutItem + GetItem (Python) â€” Ø¬Ø¯ÙˆÙ„ Ø¨Ø§ Ú©Ù„ÛŒØ¯ Ù¾Ø§Ø±ØªÛŒØ´Ù† id</div>
  <div class="code-box"><code>
import json, os, boto3, uuid
db = boto3.resource("dynamodb")
table = db.Table(os.environ.get("TABLE", "items"))

def lambda_handler(event, context):
    body = json.loads(event.get("body") or "{}")
    if event.get("httpMethod") == "POST":
        item = {"id": str(uuid.uuid4()), **body}
        table.put_item(Item=item)
        return {"statusCode":201, "body": json.dumps(item)}

    if event.get("httpMethod") == "GET":
        id_ = (event.get("pathParameters") or {}).get("id")
        if not id_:
            return {"statusCode":400, "body":"missing id"}
        res = table.get_item(Key={"id": id_})
        return {"statusCode":200, "body": json.dumps(res.get("Item"))}

    return {"statusCode":405, "body":"Method Not Allowed"}
  </code></div>

  <div class="note">8) UpdateItem Ø´Ø±Ø·ÛŒ (Node.js) â€” Ø¬Ù„ÙˆÚ¯ÛŒØ±ÛŒ Ø§Ø² overwrite Ù†Ø§Ø®ÙˆØ§Ø³ØªÙ‡</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const ddb = new AWS.DynamoDB.DocumentClient();
const TABLE = process.env.TABLE || "items";

exports.handler = async (event) => {
  const { id, ...fields } = JSON.parse(event.body || "{}");
  await ddb.update({
    TableName: TABLE,
    Key: { id },
    UpdateExpression: "SET #n = :n",
    ExpressionAttributeNames: { "#n": "name" },
    ExpressionAttributeValues: { ":n": fields.name },
    ConditionExpression: "attribute_exists(id)"
  }).promise();
  return { statusCode: 200, body: "updated" };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ EventBridge / Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ</h2>

  <div class="note">9) Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ Ø¯Ø± S3 (Node.js) â€” Scheduled</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const s3 = new AWS.S3();
const DAY = 24 * 60 * 60 * 1000;
exports.handler = async () => {
  const Bucket = process.env.BUCKET;
  const Prefix = process.env.PREFIX || "";
  const list = await s3.listObjectsV2({ Bucket, Prefix }).promise();
  const now = Date.now();
  const old = (list.Contents || []).filter(o => (now - new Date(o.LastModified).getTime()) > 7*DAY);
  if (!old.length) return { statusCode:200, body:"no old files" };
  await s3.deleteObjects({ Bucket, Delete: { Objects: old.map(o => ({Key:o.Key})) } }).promise();
  return { statusCode:200, body:`deleted ${old.length}` };
};
  </code></div>

  <div class="note">10) Heartbeat Ø«Ø¨Øª ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± CloudWatch Metric (Python)</div>
  <div class="code-box"><code>
import boto3, os, time
cw = boto3.client("cloudwatch")
def lambda_handler(event, context):
    cw.put_metric_data(
      Namespace="WorldSkills/Lambda",
      MetricData=[{
        "MetricName":"Heartbeat",
        "Value":1, "Unit":"Count",
        "Dimensions":[{"Name":"Function","Value":context.function_name}]
      }]
    )
    return {"ok": True, "ts": int(time.time())}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Cognito Triggers</h2>

  <div class="note">11) Pre Sign-up: ØªØ£ÛŒÛŒØ¯ Ø®ÙˆØ¯Ú©Ø§Ø± Ø§ÛŒÙ…ÛŒÙ„/Ú©Ø§Ø±Ø¨Ø± (Python)</div>
  <div class="code-box"><code>
def lambda_handler(event, context):
    event["response"]["autoConfirmUser"] = True
    event["response"]["autoVerifyEmail"] = True
    return event
  </code></div>

  <div class="note">12) Post Confirmation: Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ SNS (Node.js)</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const sns = new AWS.SNS();
exports.handler = async (event) => {
  const user = event.request.userAttributes.email;
  await sns.publish({
    TopicArn: process.env.TOPIC_ARN,
    Message: `New confirmed user: ${user}`
  }).promise();
  return event;
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ SNS / SQS Ø§Ù„Ú¯ÙˆÙ‡Ø§</h2>

  <div class="note">13) Fan-out: API â†’ SNS â†’ (SQS Ú©Ù†Ø³ÙˆÙ…Ø±Ù‡Ø§ÛŒ Ù…ØªØ¹Ø¯Ø¯) (Node.js: Publisher)</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const sns = new AWS.SNS();
exports.handler = async (event) => {
  const body = JSON.parse(event.body || "{}");
  await sns.publish({ TopicArn: process.env.TOPIC_ARN, Message: JSON.stringify(body) }).promise();
  return { statusCode: 200, body: "published" };
};
  </code></div>

  <div class="note">14) SQS Consumer (Python) â€” Lambda Ø¨Ø§ ØªØ±ÛŒÚ¯Ø± SQS</div>
  <div class="code-box"><code>
import json
def lambda_handler(event, context):
    for rec in event["Records"]:
        msg = json.loads(rec["body"])
        # Ù¾Ø±Ø¯Ø§Ø²Ø´ Ù¾ÛŒØ§Ù…
        print("Message:", msg)
    return {"ok": True}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Ø§ÛŒÙ…ÛŒÙ„ / SES</h2>

  <div class="note">15) Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§ SES (Python) â€” Ø¨Ø¹Ø¯ Ø§Ø² Ø±Ø®Ø¯Ø§Ø¯ Ø®Ø§Øµ</div>
  <div class="code-box"><code>
import boto3, os
ses = boto3.client("ses")
SENDER = os.environ.get("SENDER")
def lambda_handler(event, context):
    ses.send_email(
      Source=SENDER,
      Destination={"ToAddresses":[event.get("to","test@example.com")]},
      Message={
        "Subject":{"Data":"WorldSkills Update"},
        "Body":{"Text":{"Data":"Lambda completed successfully."}}
      }
    )
    return {"sent": True}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Rekognition / Ù¾Ø±Ø¯Ø§Ø²Ø´ ØªØµÙˆÛŒØ±</h2>

  <div class="note">16) Label Detection (Node.js) â€” Ø±ÙˆÛŒ Ø¹Ú©Ø³ S3</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const rekog = new AWS.Rekognition();
exports.handler = async (event) => {
  const Bucket = event.bucket, Name = event.key;
  const res = await rekog.detectLabels({ Image:{ S3Object:{Bucket, Name} }, MaxLabels: 10 }).promise();
  return { labels: res.Labels.map(l => l.Name) };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Secrets Manager / Parameter Store</h2>

  <div class="note">17) Ú¯Ø±ÙØªÙ† Secret Ùˆ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ù…Ù† (Python)</div>
  <div class="code-box"><code>
import boto3, json, os
sm = boto3.client("secretsmanager")
def lambda_handler(event, context):
    sec_arn = os.environ["SECRET_ARN"]
    val = sm.get_secret_value(SecretId=sec_arn)
    secret = json.loads(val["SecretString"])
    # Ù…Ø«Ù„Ø§ secret["db_password"]
    return {"has_secret": "db_password" in secret}
  </code></div>

  <div class="note">18) SSM Parameter (Node.js)</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const ssm = new AWS.SSM();
exports.handler = async () => {
  const p = await ssm.getParameter({ Name: process.env.PARAM, WithDecryption: true }).promise();
  return { value: p.Parameter.Value };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ RDS (Ø¯Ø§Ø®Ù„ VPC)</h2>

  <div class="note">19) Ø§ØªØµØ§Ù„ Ø¨Ù‡ RDS (MySQL) Ø¯Ø§Ø®Ù„ VPC (Node.js) â€” Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ù¾Ú©ÛŒØ¬ mysql2 Ùˆ Ú©Ø§Ù†ÙÛŒÚ¯ VPC</div>
  <div class="code-box"><code>
// npm i mysql2  (Ù„Ø§ÛŒÙ‡ ÛŒØ§ zip Ø¢Ù¾Ù„ÙˆØ¯)
const mysql = require("mysql2/promise");
exports.handler = async () => {
  const conn = await mysql.createConnection({
    host: process.env.DB_HOST, user: process.env.DB_USER,
    password: process.env.DB_PASS, database: process.env.DB_NAME
  });
  const [rows] = await conn.execute("SELECT NOW() AS now");
  await conn.end();
  return rows[0];
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Presigned URL (S3)</h2>

  <div class="note">20) Ø³Ø§Ø®Øª Ù„ÛŒÙ†Ú© Ø¢Ù¾Ù„ÙˆØ¯ Ù…ÙˆÙ‚Øª Ø¨Ø±Ø§ÛŒ Ú©Ù„Ø§ÛŒÙ†Øª (Python)</div>
  <div class="code-box"><code>
import boto3, os
s3 = boto3.client("s3")
def lambda_handler(event, context):
    bucket = os.environ["BUCKET"]; key = event.get("key","uploads/file.bin")
    url = s3.generate_presigned_url(
      "put_object", Params={"Bucket": bucket, "Key": key}, ExpiresIn=900
    )
    return {"upload_url": url, "key": key}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Kinesis / Stream Processing</h2>

  <div class="note">21) Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø±Ú©ÙˆØ±Ø¯Ù‡Ø§ÛŒ Kinesis (Node.js)</div>
  <div class="code-box"><code>
exports.handler = async (event) => {
  for (const rec of event.Records) {
    const payload = Buffer.from(rec.kinesis.data, "base64").toString("utf-8");
    console.log("record:", payload);
  }
  return { ok: true };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Step Functions</h2>

  <div class="note">22) ÙˆØ¸ÛŒÙÙ‡â€ŒÛŒ Ú©ÙˆÚ†Ú© Ø¨Ø±Ø§ÛŒ Orchestrator (Python) â€” ÙˆØ±ÙˆØ¯ÛŒ Ø±Ø§ enrichment Ù…ÛŒâ€ŒÚ©Ù†Ø¯</div>
  <div class="code-box"><code>
def lambda_handler(event, context):
    event["enriched"] = True
    return event
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ ÙÛŒÙ„ØªØ± Ù„Ø§Ú¯ Ùˆ Ù…ØªØ±ÛŒÚ©</h2>

  <div class="note">23) ØªÙˆÙ„ÛŒØ¯ Ø³Ø§Ø®ØªØ§Ø± Ù„Ø§Ú¯ JSON Ø¨Ø±Ø§ÛŒ ÙÛŒÙ„ØªØ±Ù‡Ø§ÛŒ CloudWatch (Node.js)</div>
  <div class="code-box"><code>
exports.handler = async () => {
  console.log(JSON.stringify({ level:"INFO", service:"lambda", msg:"started" }));
  console.warn(JSON.stringify({ level:"WARN", code:123, msg:"something odd" }));
  return { ok: true };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Ø®Ø·Ø§ØŒ RetryØŒ DLQ</h2>

  <div class="note">24) Ø§Ù„Ú¯ÙˆÛŒ Ø®Ø·Ø§ Ø¨Ø§ Retry Ú©Ù†ØªØ±Ù„â€ŒØ´Ø¯Ù‡ (Python)</div>
  <div class="code-box"><code>
import random, time
def lambda_handler(event, context):
    if random.random() < 0.7:
        raise Exception("temporary failure")  # Ø¨Ø§ Retry ØªÙ†Ø¸ÛŒÙ…Ø§Øª Event source Ø­Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯
    return {"ok": True}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Ø§Ù…Ù†ÛŒØª Ùˆ IAM (Ù†Ù…ÙˆÙ†Ù‡ Ø³ÛŒØ§Ø³Øªâ€ŒÙ‡Ø§)</h2>

  <div class="note">25) Ø¯Ø³ØªØ±Ø³ÛŒ DynamoDB CRUD Ø­Ø¯Ø§Ù‚Ù„ÛŒ Ø¨Ø±Ø§ÛŒ ÛŒÚ© Ø¬Ø¯ÙˆÙ„ (JSON)</div>
  <div class="code-box"><code>
{
  "Version":"2012-10-17",
  "Statement":[
    {
      "Effect":"Allow",
      "Action":[ "dynamodb:PutItem","dynamodb:GetItem","dynamodb:UpdateItem","dynamodb:DeleteItem","dynamodb:Query","dynamodb:Scan" ],
      "Resource":[ "arn:aws:dynamodb:REGION:ACCOUNT_ID:table/YourTable" ]
    }
  ]
}
  </code></div>

  <div class="note">26) Ø§Ø¬Ø§Ø²Ù‡ Ø¯Ø³ØªØ±Ø³ÛŒ S3 Ø®Ø§Øµ (Read/Write Ø±ÙˆÛŒ ÛŒÚ© Prefix) (JSON)</div>
  <div class="code-box"><code>
{
  "Version":"2012-10-17",
  "Statement":[
    { "Effect":"Allow", "Action":[ "s3:PutObject","s3:GetObject" ],
      "Resource":[ "arn:aws:s3:::your-bucket/uploads/*" ] }
  ]
}
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Ø¨Ù‡ÛŒÙ†Ù‡â€ŒØ³Ø§Ø²ÛŒ Ùˆ Ù†Ú©Ø§Øª Ù…Ø³Ø§Ø¨Ù‚Ù‡</h2>

  <div class="note">27) Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ/Ø­Ø§ÙØ¸Ù‡/Ø²Ù…Ø§Ù† Ø§Ø¬Ø±Ø§</div>
  <div class="code-box"><code>
# Ù†Ú©Ø§Øª:
# - Memory Ø¨ÛŒØ´ØªØ± => CPU Ø¨ÛŒØ´ØªØ± => Ø³Ø±ÛŒØ¹â€ŒØªØ± (ØªØ§ Ù‡Ø²ÛŒÙ†Ù‡/Ø²Ù…Ø§Ù† Ø¨Ù‡ÛŒÙ†Ù‡ Ø´ÙˆØ¯)
# - Timeout Ø±Ø§ Ø¨Ø§ ØªÙˆØ¬Ù‡ Ø¨Ù‡ ÙˆØ§Ø¨Ø³ØªÚ¯ÛŒâ€ŒÙ‡Ø§ÛŒ Ø´Ø¨Ú©Ù‡â€ŒØ§ÛŒ (RDS/VPC) ØªÙ†Ø¸ÛŒÙ… Ú©Ù†
# - Ø¨Ø±Ø§ÛŒ Ù¾Ú©ÛŒØ¬â€ŒÙ‡Ø§ÛŒ Ø³Ù†Ú¯ÛŒÙ† Ø§Ø² Layers Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†
# - Ø¨Ø±Ø§ÛŒ VPC: Ø³Ø§Ø¨â€ŒÙ†Øª Ø®ØµÙˆØµÛŒ + NAT Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ø§ÛŒÙ†ØªØ±Ù†ØªÛŒ
  </code></div>

  <div class="note">28) Ø§Ù„Ú¯ÙˆÛŒ Handler Ø³Ø¨Ú© Ø¨Ø±Ø§ÛŒ ØªØ³Øª Ø³Ø±ÛŒØ¹ (Node.js)</div>
  <div class="code-box"><code>
exports.handler = async (event, context) => {
  return { statusCode:200, headers:{"Content-Type":"text/plain"}, body:"OK" };
};
  </code></div>

  <hr class="separator">

  <h2>ğŸ”¹ Glue Code Ù‡Ø§ÛŒ Ø±Ø§ÛŒØ¬</h2>

  <div class="note">29) Validate Ø§Ù…Ø¶Ø§/ØªÙˆÚ©Ù† Ø³Ø§Ø¯Ù‡ API (Node.js) â€” Ù‡Ø¯Ø± Ø³ÙØ§Ø±Ø´ÛŒ</div>
  <div class="code-box"><code>
exports.handler = async (event) => {
  const token = (event.headers || {})["x-api-key"];
  if (token !== process.env.API_KEY) return { statusCode:403, body:"Forbidden" };
  return { statusCode:200, body:"Authorized" };
};
  </code></div>

  <div class="note">30) Merge Ú†Ù†Ø¯ ÙˆØ±ÙˆØ¯ÛŒ Ùˆ Ø§Ø±Ø³Ø§Ù„ Ø¨Ù‡ Ø®Ø±ÙˆØ¬ÛŒ Ù…Ø´ØªØ±Ú© (Python)</div>
  <div class="code-box"><code>
def lambda_handler(event, context):
    items = event.get("items", [])
    return {"count": len(items), "items": items}
  </code></div>

   <hr class="separator">

  <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 1 -->
  <h2>ğŸ”¹ Ø³Ù†Ø§Ø±ÛŒÙˆ 1: S3 âœ Lambda (Ø³Ø§Ø®Øª Thumbnail Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ ØªØµÙˆÛŒØ±)</h2>

  <div class="note"><b>Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²</b>: ÛŒÚ© Ø¨Ø§Ú©Øª S3 (Ù…Ø«Ù„Ø§Ù‹ <code>ws-media-bucket</code>)ØŒ Ù†Ù‚Ø´ Lambda Ø¨Ø§ Ø¯Ø³ØªØ±Ø³ÛŒ Ø®ÙˆØ§Ù†Ø¯Ù†/Ù†ÙˆØ´ØªÙ† Ø¯Ø± Ø¨Ø§Ú©Øª.</div>

  <div class="note"><b>Ù…Ø±Ø§Ø­Ù„ Ú©Ù†Ø³ÙˆÙ„</b></div>
  <ul class="steps">
    <li>S3 âœ <b>Create bucket</b> âœ Name: <code>ws-media-bucket</code> âœ Region Ø«Ø§Ø¨Øª âœ Create.</li>
    <li>Lambda âœ <b>Create function</b> âœ Author from scratch âœ Name: <code>ws-s3-thumbnail</code> âœ Runtime: Python 3.12 âœ Role: <i>Create a new role with basic Lambda permissions</i> âœ Create.</li>
    <li>Lambda âœ Configuration âœ Permissions âœ Execution role âœ <b>Add permissions</b> âœ Attach: (Ø¨Ø±Ø§ÛŒ ØªÙ…Ø±ÛŒÙ†) <code>AmazonS3FullAccess</code> ÛŒØ§ Ù¾Ø§Ù„ÛŒØ³ÛŒ Ø­Ø¯Ø§Ù‚Ù„ÛŒ.</li>
    <li>Lambda âœ Configuration âœ Triggers âœ <b>Add trigger</b> âœ S3: Bucket = <code>ws-media-bucket</code> âœ Event = <b>PUT</b> (Object Created) âœ Prefix (Ø§Ø®ØªÛŒØ§Ø±ÛŒ): <code>uploads/</code> âœ Add.</li>
    <li>S3 âœ ÙˆØ§Ø±Ø¯ Ø¨Ø§Ú©Øª âœ <b>Create folder</b>: <code>uploads/</code> âœ ÛŒÚ© ØªØµÙˆÛŒØ± Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù† Ùˆ Ù†ØªÛŒØ¬Ù‡ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†.</li>
  </ul>

  <div class="note">Ú©Ø¯ Ù†Ù…ÙˆÙ†Ù‡ (Ø§Ú¯Ø± <b>Pillow</b> Ù†Ø¯Ø§Ø±ÛŒØŒ ÙØ¹Ù„Ø§Ù‹ ÙÙ‚Ø· Ù„Ø§Ú¯ Ø¨Ú¯ÛŒØ±):</div>
  <div class="code-box"><code>
# Python 3.12 - Ù†ÛŒØ§Ø²Ù…Ù†Ø¯ Ù„Ø§ÛŒÙ‡ Pillow Ø¨Ø±Ø§ÛŒ ØªÙˆÙ„ÛŒØ¯ thumbnail
import boto3, os
from PIL import Image

s3 = boto3.client("s3")
OUT_PREFIX = "thumbs/"
SIZE = (300, 300)

def lambda_handler(event, context):
    record = event["Records"][0]
    b = record["s3"]["bucket"]["name"]
    k = record["s3"]["object"]["key"]

    in_path = "/tmp/in"
    out_path = "/tmp/out.jpg"
    s3.download_file(b, k, in_path)

    img = Image.open(in_path)
    img.thumbnail(SIZE)
    img.save(out_path, "JPEG")

    out_key = OUT_PREFIX + os.path.basename(k) + ".jpg"
    s3.upload_file(out_path, b, out_key, ExtraArgs={"ContentType":"image/jpeg"})
    return {"thumb": out_key}
  </code></div>

  <div class="note warn"><b>Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø³Ø±ÛŒØ¹</b>: AccessDenied âœ Ù¾Ø§Ù„ÛŒØ³ÛŒ S3 Ø±ÙˆÛŒ Ù†Ù‚Ø´ LambdaØ› No module named PIL âœ Ù„Ø§ÛŒÙ‡ Pillow Ø§Ø¶Ø§ÙÙ‡ Ú©Ù† ÛŒØ§ Ú©Ø¯ Ø±Ø§ Ø³Ø§Ø¯Ù‡ Ú©Ù†.</div>

  <hr class="separator">

  <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 2 -->
  <h2>ğŸ”¹ Ø³Ù†Ø§Ø±ÛŒÙˆ 2: API Gateway âœ Lambda âœ DynamoDB (POST/GET Ø³Ø§Ø¯Ù‡)</h2>

  <div class="note"><b>Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²</b>: Ø¬Ø¯ÙˆÙ„ DynamoDB (Ù†Ø§Ù…: <code>ws-items</code>ØŒ Partition key: <code>id</code> String). Ù†Ù‚Ø´ Lambda Ø¨Ø§ PutItem/GetItem.</div>

  <div class="note"><b>Ù…Ø±Ø§Ø­Ù„ Ú©Ù†Ø³ÙˆÙ„</b></div>
  <ul class="steps">
    <li>DynamoDB âœ <b>Create table</b> âœ Name: <code>ws-items</code> âœ PK: <code>id</code> (String) âœ Create.</li>
    <li>Lambda âœ Create function âœ Name: <code>ws-api-items</code> âœ Runtime: Python 3.12 âœ Role: new basic âœ Create.</li>
    <li>Lambda âœ Configuration âœ Environment variables âœ <code>TABLE = ws-items</code> âœ Save.</li>
    <li>Lambda âœ Permissions âœ Attach policy Ø­Ø¯Ø§Ù‚Ù„ÛŒ (Put/Get Ø±ÙˆÛŒ ARN Ø¬Ø¯ÙˆÙ„) ÛŒØ§ Ù…ÙˆÙ‚ØªØ§Ù‹ <code>AmazonDynamoDBFullAccess</code>.</li>
    <li>API Gateway âœ Create API âœ <b>HTTP API</b> âœ Add integration: Lambda <code>ws-api-items</code>.</li>
    <li>Routes âœ <b>POST /items</b> Ùˆ <b>GET /items/{id}</b> âœ Ù‡Ø± Ø¯Ùˆ Ø¨Ù‡ Ù‡Ù…Ø§Ù† Lambda.</li>
    <li>Stages âœ Invoke URL Ø±Ø§ Ø¨Ø±Ø¯Ø§Ø± âœ Ø¨Ø§ POST Ùˆ GET ØªØ³Øª Ú©Ù†.</li>
  </ul>

  <div class="note">Ú©Ø¯ Lambda (Ù¾Ø§Ø³Ø®â€ŒÚ¯Ùˆ Ø¨Ù‡ POST/GET):</div>
  <div class="code-box"><code>
import json, os, boto3, uuid
db = boto3.resource("dynamodb")
table = db.Table(os.environ.get("TABLE","ws-items"))

def lambda_handler(event, context):
    method = (event.get("requestContext") or {}).get("http", {}).get("method") \
             or event.get("httpMethod")
    if method == "POST":
        body = json.loads(event.get("body") or "{}")
        item = {"id": str(uuid.uuid4()), **body}
        table.put_item(Item=item)
        return {"statusCode":201, "headers":{"Content-Type":"application/json"},
                "body": json.dumps(item)}
    if method == "GET":
        params = event.get("pathParameters") or {}
        id_ = params.get("id")
        if not id_:
            return {"statusCode":400,"body":"missing id"}
        res = table.get_item(Key={"id": id_})
        return {"statusCode":200,"headers":{"Content-Type":"application/json"},
                "body": json.dumps(res.get("Item"))}
    return {"statusCode":405,"body":"Method Not Allowed"}
  </code></div>

  <div class="note warn"><b>Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø³Ø±ÛŒØ¹</b>: 403/Permission âœ ARN Ø¬Ø¯ÙˆÙ„ Ø¯Ø±Ø³ØªØ› CORS âœ Ø§Ú¯Ø± Ø§Ø² Ù…Ø±ÙˆØ±Ú¯Ø± ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ Ù…ÛŒâ€ŒÚ©Ù†ÛŒ Ø¯Ø± API ÙØ¹Ø§Ù„Ø´ Ú©Ù†.</div>

  <hr class="separator">

  <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 3 -->
  <h2>ğŸ”¹ Ø³Ù†Ø§Ø±ÛŒÙˆ 3: EventBridge (Ø²Ù…Ø§Ù†â€ŒØ¨Ù†Ø¯ÛŒ) âœ Lambda (Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒ S3)</h2>

  <div class="note"><b>Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²</b>: Ø¨Ø§Ú©Øª S3 Ù…Ø«Ù„ <code>ws-media-bucket</code>. Ù†Ù‚Ø´ Lambda Ø¨Ø§ List/Delete Ø±ÙˆÛŒ Ø¨Ø§Ú©Øª/Ù¾Ø±ÛŒÙÛŒÚ©Ø³.</div>

  <div class="note"><b>Ù…Ø±Ø§Ø­Ù„ Ú©Ù†Ø³ÙˆÙ„</b></div>
  <ul class="steps">
    <li>Lambda âœ Create function âœ Name: <code>ws-s3-cleanup</code> âœ Runtime: Node.js 20 âœ Role: new basic âœ Create.</li>
    <li>Lambda âœ Configuration âœ Environment: <code>BUCKET = ws-media-bucket</code>ØŒ <code>PREFIX = uploads/</code> (Ø§Ø®ØªÛŒØ§Ø±ÛŒ).</li>
    <li>Lambda âœ Permissions âœ Attach policy Ø­Ø¯Ø§Ù‚Ù„ÛŒ: ListBucket + DeleteObject Ø±ÙˆÛŒ Ø¨Ø§Ú©Øª/Ø¢Ø¨Ø¬Ú©Øªâ€ŒÙ‡Ø§.</li>
    <li>EventBridge âœ Schedules âœ <b>Create schedule</b> âœ Name: <code>ws-s3-cleanup-daily</code> âœ Daily (Ù…Ø«Ù„Ø§Ù‹ 03:00 UTC) âœ Target: Lambda <code>ws-s3-cleanup</code> âœ Create.</li>
  </ul>

  <div class="note">Ú©Ø¯ Lambda (Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¯ÛŒÙ…ÛŒâ€ŒØªØ± Ø§Ø² Û· Ø±ÙˆØ²):</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const s3 = new AWS.S3();
const DAY = 24 * 60 * 60 * 1000;

exports.handler = async () => {
  const Bucket = process.env.BUCKET;
  const Prefix = process.env.PREFIX || "";
  const list = await s3.listObjectsV2({ Bucket, Prefix }).promise();
  const now = Date.now();
  const old = (list.Contents || []).filter(o =>
    (now - new Date(o.LastModified).getTime()) > 7 * DAY
  );
  if (!old.length) return { statusCode:200, body:"no old files" };
  await s3.deleteObjects({
    Bucket, Delete: { Objects: old.map(o => ({ Key:o.Key })) }
  }).promise();
  return { statusCode:200, body:`deleted ${old.length}` };
};
  </code></div>

  <div class="note warn"><b>Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø³Ø±ÛŒØ¹</b>: DeleteObject AccessDenied âœ Resource Ø¨Ø§ <code>/*</code>Ø› Schedule Enabled Ø¨Ø§Ø´Ø¯.</div>

  <hr class="separator">

  <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 4 -->
  <h2>ğŸ”¹ Ø³Ù†Ø§Ø±ÛŒÙˆ 4: Cognito (Pre sign-up) âœ Auto Confirm + Post Confirmation âœ SNS</h2>

  <div class="note"><b>Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²</b>: User Pool Ø¯Ø± CognitoØŒ SNS Topic (Ù…Ø«Ù„Ø§Ù‹ <code>ws-user-notify</code>) Ùˆ Subscription Ø§ÛŒÙ…ÛŒÙ„ ØªØ§ÛŒÛŒØ¯ Ø´Ø¯Ù‡.</div>

  <div class="note"><b>Ù…Ø±Ø§Ø­Ù„ Ú©Ù†Ø³ÙˆÙ„</b></div>
  <ul class="steps">
    <li>SNS âœ Topics âœ Create topic âœ Name: <code>ws-user-notify</code> âœ Create âœ Create subscription (Email) âœ Ø§ÛŒÙ…ÛŒÙ„ Ø±Ø§ Confirm Ú©Ù†.</li>
    <li>Lambda âœ Create function âœ Name: <code>ws-cognito-pre-signup</code> âœ Runtime: Python 3.12 âœ Ú©Ø¯ Pre sign-up Ø±Ø§ Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ú©Ù† (Ù¾Ø§ÛŒÛŒÙ†).</li>
    <li>Lambda âœ Create function âœ Name: <code>ws-cognito-post-confirm</code> âœ Runtime: Node.js 20 âœ Env: <code>TOPIC_ARN</code> = ARN ØªØ§Ù¾ÛŒÚ© âœ Permissions: sns:Publish Ø±ÙˆÛŒ Ù‡Ù…Ø§Ù† ARN âœ Ú©Ø¯ Ù¾Ø§ÛŒÛŒÙ† Ø±Ø§ Ø¯ÛŒÙ¾Ù„ÙˆÛŒ Ú©Ù†.</li>
    <li>Cognito âœ User Pools âœ User Pool Ø®ÙˆØ¯Øª âœ Triggers âœ Pre sign-up = <code>ws-cognito-pre-signup</code>ØŒ Post confirmation = <code>ws-cognito-post-confirm</code> âœ Save.</li>
    <li>ØªØ³Øª: Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø§Ø±Ø¨Ø± âœ Auto-confirm Ù…ÛŒâ€ŒØ´ÙˆØ¯ âœ Ø§ÛŒÙ…ÛŒÙ„ SNS Ù…ÛŒâ€ŒØ¢ÛŒØ¯.</li>
  </ul>

  <div class="note">Ú©Ø¯ Pre sign-up (Python):</div>
  <div class="code-box"><code>
def lambda_handler(event, context):
    event["response"]["autoConfirmUser"] = True
    event["response"]["autoVerifyEmail"] = True
    return event
  </code></div>

  <div class="note">Ú©Ø¯ Post confirmation (Node.js) â€“ Ø§Ø±Ø³Ø§Ù„ Ù¾ÛŒØ§Ù… Ø¨Ù‡ SNS:</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const sns = new AWS.SNS();

exports.handler = async (event) => {
  const email = event.request.userAttributes.email;
  await sns.publish({
    TopicArn: process.env.TOPIC_ARN,
    Message: `New confirmed user: ${email}`
  }).promise();
  return event;
};
  </code></div>

  <div class="note warn"><b>Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø³Ø±ÛŒØ¹</b>: Trigger Ø§Ø¬Ø±Ø§ Ù†Ø´Ø¯ âœ Region ÛŒÚ©Ø³Ø§Ù†Ø› Ø§ÛŒÙ…ÛŒÙ„ Ù†ÛŒØ§Ù…Ø¯ âœ Subscription Ø±Ø§ ØªØ£ÛŒÛŒØ¯ Ú©Ù†.</div>

  <hr class="separator">

  <!-- Ø³Ù†Ø§Ø±ÛŒÙˆ 5 -->
  <h2>ğŸ”¹ Ø³Ù†Ø§Ø±ÛŒÙˆ 5: API âœ SNS (Fan-out) âœ SQS âœ Lambda (Consumer)</h2>

  <div class="note"><b>Ù¾ÛŒØ´â€ŒÙ†ÛŒØ§Ø²</b>: ÛŒÚ© SNS Topic (<code>ws-fanout</code>)ØŒ Ø¯Ùˆ SQS Queue (<code>ws-q-a</code> / <code>ws-q-b</code>) Ùˆ Subscription Ù‡Ø± Ø¯Ùˆ Ø¨Ù‡ ØªØ§Ù¾ÛŒÚ©.</div>

  <div class="note"><b>Ù…Ø±Ø§Ø­Ù„ Ú©Ù†Ø³ÙˆÙ„</b></div>
  <ul class="steps">
    <li>SNS âœ Create topic âœ Name: <code>ws-fanout</code>.</li>
    <li>SQS âœ Create queue âœ <code>ws-q-a</code> Ùˆ Ø¯ÙˆØ¨Ø§Ø±Ù‡ <code>ws-q-b</code> (Standard).</li>
    <li>Ø¯Ø± SNS Topic âœ Create subscription âœ Protocol: SQS âœ Endpoint: Ù‡Ø± Queue.</li>
    <li>Lambda âœ Create function âœ Name: <code>ws-publish</code> âœ Runtime: Node.js 20 âœ Env: <code>TOPIC_ARN</code> = ARN ØªØ§Ù¾ÛŒÚ© âœ Permissions: sns:Publish Ø±ÙˆÛŒ Ù‡Ù…Ø§Ù† ARN âœ Ú©Ø¯ Publisher Ù¾Ø§ÛŒÛŒÙ†.</li>
    <li>API Gateway âœ HTTP API âœ Add integration: Lambda <code>ws-publish</code> âœ Route: <b>POST /publish</b> âœ Create.</li>
    <li>Lambda âœ Create function âœ Name: <code>ws-consumer</code> âœ Runtime: Python 3.12 âœ Triggers âœ Add: SQS = ÛŒÚ©ÛŒ Ø§Ø² QueueÙ‡Ø§ âœ Ú©Ø¯ Consumer Ù¾Ø§ÛŒÛŒÙ†.</li>
  </ul>

  <div class="note">Publisher (Node.js):</div>
  <div class="code-box"><code>
const AWS = require("aws-sdk");
const sns = new AWS.SNS();

exports.handler = async (event) => {
  const body = JSON.parse(event.body || "{}");
  await sns.publish({
    TopicArn: process.env.TOPIC_ARN,
    Message: JSON.stringify(body)
  }).promise();
  return { statusCode: 200, body: "published" };
};
  </code></div>

  <div class="note">Consumer (Python) â€“ Trigger: SQS:</div>
  <div class="code-box"><code>
import json
def lambda_handler(event, context):
    for rec in event["Records"]:
        msg = json.loads(rec["body"])
        print("Message:", msg)
    return {"ok": True}
  </code></div>

  <div class="note warn"><b>Ø¹ÛŒØ¨â€ŒÛŒØ§Ø¨ÛŒ Ø³Ø±ÛŒØ¹</b>: Permissions Publisher = sns:PublishØ› Consumer = Receive/DeleteMessage (Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ø§ ØªØ±ÛŒÚ¯Ø± Ø®ÙˆØ¯Ú©Ø§Ø± Ø§Ø¶Ø§ÙÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯). Ø¨Ø±Ø§ÛŒ Ø®Ø·Ø§Ù‡Ø§ÛŒ Ù…Ú©Ø±Ø± DLQ ØªØ¹Ø±ÛŒÙ Ú©Ù†.</div>

  <hr class="separator">

</body>
</html>
