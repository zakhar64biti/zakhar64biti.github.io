<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8">
  <title>راهنمای ساخت کلاستر EKS و استقرار Nginx</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: "Vazirmatn", sans-serif;
      background: #f7f9fc;
      color: #222;
      margin: 0;
      padding: 0;
      direction: rtl;
      line-height: 1.8;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 30px;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.05);
    }

    h1, h2 {
      color: #0a3a60;
      margin-top: 0;
    }

    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }

    h2 {
      margin-top: 40px;
      font-size: 20px;
      border-right: 4px solid #0078d7;
      padding-right: 10px;
    }

    ol {
      padding-right: 20px;
    }

    pre {
      background: #f0f3f7;
      border-radius: 6px;
      padding: 10px 14px;
      overflow-x: auto;
      margin: 8px 0;
      font-family: monospace;
      color: #2a2a2a;
    }

    button.copy {
      background: #0078d7;
      color: white;
      border: none;
      padding: 6px 10px;
      border-radius: 5px;
      font-size: 13px;
      cursor: pointer;
      margin-top: 4px;
    }

    button.copy:hover {
      background: #005ea3;
    }

    .note {
      background: #eaf3ff;
      border-right: 4px solid #0078d7;
      padding: 10px;
      border-radius: 5px;
      margin-top: 8px;
      font-size: 14px;
    }

    footer {
      text-align: center;
      font-size: 13px;
      color: #777;
      margin-top: 40px;
      border-top: 1px solid #eee;
      padding-top: 10px;
    }
  </style>
</head>
<body>

<div class="container">
  <h1>راهنمای ساخت کلاستر EKS و استقرار اپلیکیشن تست (Nginx)</h1>
  <p>این راهنما قدم‌به‌قدم شما را برای ساخت کلاستر Amazon EKS، نصب ابزارها و استقرار یک اپ Nginx هدایت می‌کند.</p>

  <h2>بخش ۱ - نصب AWS CLI، kubectl و eksctl</h2>
  <ol>
    <li>بررسی نسخه فعلی AWS CLI:
      <pre>aws --version</pre>
      <div class="note">اگر نسخه 1.18 بود، باید به نسخه 2 ارتقا دهید.</div>
    </li>

    <li>دانلود AWS CLI 2:
      <pre>curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"</pre>
    </li>

    <li>استخراج فایل ZIP:
      <pre>unzip awscliv2.zip</pre>
    </li>

    <li>مشاهده مسیر aws:
      <pre>which aws</pre>
      <div class="note">معمولاً در مسیر <code>/usr/bin/aws</code> قرار دارد.</div>
    </li>

    <li>نصب AWS CLI نسخه 2:
      <pre>sudo ./aws/install --bin-dir /usr/bin --install-dir /usr/bin/aws-cli --update</pre>
    </li>

    <li>بررسی مجدد نسخه:
      <pre>aws --version</pre>
      <div class="note">باید چیزی مانند <code>AWS CLI 2.11</code> مشاهده کنید.</div>
    </li>

    <li>پیکربندی AWS:
      <pre>aws configure</pre>
      <div class="note">Access Key و Secret Key را از فایل CSV وارد کنید. Region: <b>us-east-1</b>، Output: <b>json</b>.</div>
    </li>

    <li>دانلود kubectl:
      <pre>curl -O https://s3.us-west-2.amazonaws.com/amazon-eks/1.30.2/2024-07-12/bin/linux/amd64/kubectl</pre>
    </li>

    <li>دادن دسترسی اجرا:
      <pre>chmod +x ./kubectl</pre>
    </li>

    <li>انتقال kubectl به مسیر کاربر:
      <pre>mkdir -p $HOME/bin && cp ./kubectl $HOME/bin/kubectl && export PATH=$PATH:$HOME/bin</pre>
    </li>

    <li>دانلود و نصب eksctl:
      <pre>curl --silent --location "https://github.com/weaveworks/eksctl/releases/latest/download/eksctl_$(uname -s)_amd64.tar.gz" | tar xz -C /tmp
sudo mv /tmp/eksctl /usr/local/bin</pre>
    </li>

    <li>بررسی نسخه:
      <pre>eksctl version</pre>
    </li>

    <li>ایجاد کلاستر:
      <pre>eksctl create cluster --name myeks --region us-east-1 --zones=us-east-1a,us-east-1b --nodegroup-name eks-workers --node-type t3.medium --nodes 2 --nodes-min 2 --nodes-max 4 --managed</pre>
      <div class="note">ایجاد کلاستر ممکن است چند دقیقه طول بکشد.</div>
    </li>

    <li>اتصال به کلاستر:
      <pre>aws eks update-kubeconfig --name myeks --region us-east-1</pre>
    </li>

    <li>بررسی وضعیت کلاستر:
      <pre>eksctl get cluster</pre>
    </li>
  </ol>

  <h2>بخش ۲ - استقرار اپ Nginx در کلاستر</h2>
  <ol>
    <li>نصب Git:
      <pre>sudo yum install git -y</pre>
    </li>

    <li>کلون کردن مخزن آموزشی:
      <pre>git clone https://github.com/ACloudGuru-Resources/Course_EKS-Basics</pre>
    </li>

    <li>ورود به مسیر پروژه:
      <pre>cd Course_EKS-Basics/</pre>
    </li>

    <li>بررسی محتویات:
      <pre>ls</pre>
    </li>

    <li>اعمال فایل سرویس:
      <pre>kubectl apply -f nginx-svc.yaml</pre>
    </li>

    <li>اعمال فایل Deployment:
      <pre>kubectl apply -f nginx-deployment.yaml</pre>
    </li>

    <li>بررسی Deployment:
      <pre>kubectl get deployment</pre>
    </li>

    <li>بررسی Pods:
      <pre>kubectl get pods</pre>
    </li>

    <li>بررسی سرویس و DNS Load Balancer:
      <pre>kubectl get svc</pre>
      <div class="note">در ستون <b>EXTERNAL-IP</b> آدرس Load Balancer را خواهید دید.</div>
    </li>
  </ol>

  <h2>بخش ۳ - تست سرویس</h2>
  <ol>
    <li>کپی DNS از خروجی <code>kubectl get svc</code></li>
    <li>تست سرویس:
      <pre>curl <DNS-Name></pre>
      <div class="note">باید صفحه پیش‌فرض Nginx را مشاهده کنید.</div>
    </li>
  </ol>
</div>

</body>
</html>
